<%-include('../layouts/header.ejs') -%>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart</title>
    <link rel="apple-touch-icon" sizes="180x180" href="" />
    <!-- assets/img/favicons/apple-touch-icon.png -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/img/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assets/img/favicons/favicon-16x16.png"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/img/favicons/favicon.ico"
    />
    <link rel="manifest" href="assets/img/favicons/manifest.json" />
    <meta
      name="msapplication-TileImage"
      content="assets/img/favicons/mstile-150x150.png"
    />
    <meta name="theme-color" content="#ffffff" />

    <!-- ===============================================-->
    <!--    Stylesheets-->
    <!-- ===============================================-->
    <link href="assets/css/theme.css" rel="stylesheet" />
   <script>
       
      function popupdelete(){
        swal("Removed!", "Item has been removed!", "success" );

      }
    </script>
    <style>
      body {
        background-color: #fbfbfb;
      }
      @media (min-width: 991.98px) {
        main {
          padding-left: 240px;
        }
      }
      .quantity {
        width: 43px;
      }
      .add {
        width: 28px;
        border: white;
        border-radius: 24px;
      }
      .subract {
        width: 28px;
        border: white;
        border-radius: 24px;
      }
      /* Sidebar */
      .sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        padding: 58px 0 0; /* Height of navbar */
        box-shadow: 0 2px 5px 0 rgb(0 0 0 / 5%), 0 2px 10px 0 rgb(0 0 0 / 5%);
        width: 240px;
        z-index: 600;
      }
      .contentbox {
        margin-left: 25%;
        margin-right: 8%;
      }

      @media (max-width: 991.98px) {
        .sidebar {
          width: 100%;
        }
      }
      .sidebar .active {
        border-radius: 5px;
        box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);
      }

      .sidebar-sticky {
        position: relative;
        top: 0;
        height: calc(100vh - 48px);
        padding-top: 0.5rem;
        overflow-x: hidden;
        overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
      }

      /*/////////////////////////////*/
      .bn3637 {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.1rem 1rem;
  font-weight: 700;
  font-size: 18px;
  text-align: center;
  text-decoration: none;
  color: #000000;
  backface-visibility: hidden;
  border: 0.3rem solid transparent;
  border-radius: 2rem;
}
.bn38 {
  border-color: transparent;
  transition: background-color 0.3s ease-in-out;
}
  
.bn38:hover {
  background-color: #60605e;
}

    </style>
   
  </head>
  <body>
    <!--Main Navigation-->
    <header>
      <!-- Sidebar -->
      <nav
        id="sidebarMenu"
        class="collapse d-lg-block sidebar collapse bg-white"
      >
        <div class="position-sticky">
          <div class="list-group list-group-flush mx-3 mt-4">
            <a
              href="/view-profile"
              class="list-group-item list-group-item-action py-2 ripple"
              aria-current="true"
            >
              <i class="fas fa-tachometer-alt fa-fw me-3"></i
              ><span>My Profile</span>
            </a>
            <a
              href="/view-orders"
              class="list-group-item list-group-item-action py-2 ripple"
            >
              <i class="fas fa-chart-area fa-fw me-3"></i><span>My Orders</span>
            </a>
            <a
              href="/view-wishlist"
              class="list-group-item list-group-item-action py-2 ripple"
            >
              <i class="fas fa-chart-area fa-fw me-3"></i
              ><span>My Wishlist</span>
            </a>
            <a
              href="/view-cart"
              class="list-group-item list-group-item-action py-2 ripple active"
            >
              <i class="fas fa-chart-area fa-fw me-3"></i><span>My Cart</span>
            </a>
          </div>
        </div>
      </nav>
      <!-- Sidebar -->

      <!-- Navbar -->
    </header>
    <!--Main Navigation-->

    <!--Main layout-->
    <main style="margin-top: 58px">
      <div class="container pt-4"></div>
    </main>
    <!--Main layout-->

    <nav
      class="navbar navbar-expand-lg navbar-light fixed-top py-3 d-block"
      data-navbar-on-scroll="data-navbar-on-scroll"
    >
      <div class="container">
        <a class="navbar-brand d-inline-flex" href="/"
          ><img
            class="d-inline-block"
            src="assets/img/gallery/logo.png"
            alt="logo"
          /><span class="text-1000 fs-0 fw-bold ms-2">Majestic</span></a
        >
        <button
          class="navbar-toggler collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse border-top border-lg-0 mt-4 mt-lg-0"
          id="navbarSupportedContent"
        >
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
             <% cate.forEach(function(cate){%>
              <li class="nav-item px-2"><a class="nav-link fw-medium active" aria-current="page" href="/view-<%= cate.name %>"><%= cate.name%></a></li>
               <%})%> 
            <li class="nav-item px-2">
              <a class="nav-link fw-medium" href="/viewProducts">All Items</a>
            </li>
          </ul>
          <form class="d-flex">
            <a class="text-1000" href="/view-orders">
              <svg
                class="feather feather-phone me-3"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                ></path></svg
            ></a>

            
            <a class="text-1000" href="/view-cart">
              <svg
                class="feather feather-shopping-cart me-3"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path
                  d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
                ></path></svg
            ></a>

            <a class="text-1000" href="/view-profile">
              <svg
                class="feather feather-user me-3"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle></svg
            ></a>

            <a class="text-1000" href="/view-wishlist">
              <svg
                class="feather feather-heart me-3"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
                ></path></svg
            ></a>

            <a href="/logout">Log Out</a>
          </form>
        </div>
      </div>
    </nav>
    <div class="contentbox pt-4">
      <h3>MY CART</h3>
      <br>

      <table class="table bg-light">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Product</th>
            <th scope="col">Image</th>
            <th scope="col">Price</th>
            <th scope="col">Quantity</th>
        
            <th scope="col">Options</th>
          </tr>
        </thead>
        <tbody>
          <% products.forEach(function(product,index){%>
          <tr>
            <th scope="row"><%=index+1 %></th>
            <td><%= product.productId.productname %></td>
            <td>
              <img
                src="/product-images/<%= product.productId.image[0] %>"
                height="100"
                width="100"
                alt=""
              />
            </td>
            <td>Rs:<%= product.productId.price %></td>
            <td>
              <div class="number">
                <% if(product.quantity!=1) {%>

                  <button onclick="changeqnty('<%= userid %>','<%= product.productId._id %>',-1)" class=" bn38 bn3637 sub">-</button>

                <%}%>
                 
                <%= product.quantity %>
                <button onclick="changeqnty('<%= userid %>','<%= product.productId._id %>',1)" class="bn38 bn3637 ad">+</button>
                               
                <script>
                        function changeqnty(userid,proid,count){
                            $.ajax({
                              url:'/change-product-quantity',
                              data:{
                                user:userid,
                                product:proid,
                                count:count
                              },
                              method:'post',
                              encoded:true,
                              success:(response)=>{
                              
                              },
                            }).done((data)=>{
                              console.log(data);
                                    if (data.success) {
                                      window.location.reload();
                            }
                          });
                          
                          }                      
                </script>
              </div>
            </td>
            
            <td>
              <!-- <a href="/delete-cartitem?id=<%= product.productId._id %>"><button class="btn btn-outline-danger">Remove</button></a> -->
              <button
              class="btn btn-outline-danger"
              onclick="deleteitem('<%= product.productId._id %>');popupdelete()">
              Remove </button>
              <script>
              function deleteitem(id) {
                $.ajax({
                  url: "/delete-cartitem",
                  method: "post",
                  encoded: true,
                  data: {
                    id: id,
                  },
                }).done((data) => {
                  console.log(data);
                  if (data.success) {
                     setTimeout(function() {
                          location.reload();
                        }, 1000);
                    
                  }
                });
              }
            </script>
            </td>
          </tr>

          <%})%>
        </tbody>
      </table>
      <div class="pr-5">
      <h5 class="mr-5 mt-4">Total:<%= Total %></h5>
      <a href="/place-order" class="btn btn-success mt-3"><b>Place Order</b></a>

      </div>
    
     
      <br /><br />
    </div>

    <script src="vendors/@popperjs/popper.min.js"></script>
    <script src="vendors/bootstrap/bootstrap.min.js"></script>
    <script src="vendors/is/is.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=window.scroll"></script>
    <script src="vendors/feather-icons/feather.min.js"></script>
    <script>
      feather.replace();
    </script>
    <script src="assets/js/theme.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Jost:wght@200;300;400;500;600;700;800;900&amp;display=swap"
      rel="stylesheet"
    />
  </body>
</html>
